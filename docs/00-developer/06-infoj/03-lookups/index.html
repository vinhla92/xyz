<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lookups</title>
  <style>

    .grid {
      display: block;
      margin: 20px;
      font-family: system-ui;
      display:grid;
      grid-column-gap: 15px;
      grid-template-columns: 1fr 5fr;
    }

    .grid > .toggle {
        display: none;
        border-right: 2px solid #000;
        padding: 5px;
    }

    .grid > .toggle > .burger {
      border-top: 2px solid #eee;
      margin-top: 5px;
      box-shadow: 1px 1px 1px #999;
    }

    .grid > .toggle:hover {
      cursor: pointer;
    }

    @media only screen and (max-width: 900px) {
      .grid {
        grid-template-columns: 30px 5fr;
      }

      .grid > .nav {
        display: none;
      }

      .grid > .toggle {
        display: block;
      }
    }

    ._grid {
      grid-template-columns: 1fr 5fr;
    }

    ._grid > .nav {
      display: block;
    }

    ._grid > .toggle {
      display: none;
    }

    .grid > .nav {
      grid-column: 1;
      padding-inline-start: 0px;
      list-style-type: none;
    }

    .grid > .content {
      grid-column: 2/4;
    }

    .active {
      font-weight: bold;
    }

    a {
      text-decoration: none;
      white-space: nowrap;
      color: #333;
    }

    li {
      line-height: 1.5;
    }

    li._1 {
      padding-left: 0px;
    }

    li._2 {
      padding-left: 0px;
    }

    li._3 {
      padding-left: 0px;
    }

    li._4 {
      padding-left: 0px;
    }

    li._5 {
      padding-left: 20px;
    }

    li._6 {
      padding-left: 40px;
    }

    li.first {
      padding-left: 0px;
      margin-top: 10px;
    }

    li.second {
      padding-left: 20px;
    }

    pre {
      display: block;
      font-family: monospace;
      white-space: pre;
      margin: 1em 0px;
      padding: 20px;
      box-shadow: 0px 0px 2px #555;
      border-radius: 5px;
      overflow-x: scroll;
    }

    pre > code {
      font-family: monospace;
    }

    .content a {
      color: #090;
    }

    .content img {
      max-width: 100%;
    }
  </style>

</head>

<body>

  <div class="grid">

    <div id="toggle" class="toggle"><div class="burger"></div><div class="burger"></div><div class="burger"></div></div>

    <ul class="nav">

      
      <li>
        <a style="font-weight: bold; font-size: 30px;" href="/xyz/docs"><---</a>
      </li>
      
      
      
      
      <li class="_4  ">
        <a href="/xyz/docs/00-developer/00-introduction/">Developer</a>
      </li>
      
      
      
      <li class="_4  ">
        <a href="/xyz/docs/00-developer/01-license/">License</a>
      </li>
      
      
      
      <li class="_5 first ">
        <a href="/xyz/docs/00-developer/02-access/00-access/">Access</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/02-access/01-acl/">Access Control List (ACL)</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/02-access/02-registration/">User Account Registration</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/02-access/03-password-reset/">Password Reset</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/02-access/04-failed-login-attempts/">Failed Login attempts</a>
      </li>
      
      
      
      <li class="_5 first ">
        <a href="/xyz/docs/00-developer/03-environment_settings/00-environment-settings/">Environment Settings</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/03-environment_settings/01-hosting/">Hosting</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/03-environment_settings/02-access-control/">Access Control</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/03-environment_settings/03-workspace-connections/">Workspace Connections</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/03-environment_settings/04-3rd-party-api-keys/">3rd Party API Keys</a>
      </li>
      
      
      
      <li class="_5 first ">
        <a href="/xyz/docs/00-developer/04-workspaces/00-workspaces/">Workspaces</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/04-workspaces/01-editing/">Editing</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/04-workspaces/02-access-restrictions/">Access Restrictions & Filters</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/04-workspaces/03-locate/">Locate</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/04-workspaces/04-title/">Title</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/04-workspaces/05-workspace-checks/">Workspace Checks</a>
      </li>
      
      
      
      <li class="_5 first ">
        <a href="/xyz/docs/00-developer/05-layers/00-layers/">Layers</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/05-layers/01-tile-layer/">Tile Layer</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/05-layers/02-postgis-layer/">PostGIS Data Layer</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/05-layers/03-cluster-layer/">Cluster Layer</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/05-layers/04-geojson-layer/">GeoJson Layer</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/05-layers/05-vector-tile-mvt-layer/">MapBox Vector Tile (MVT) Layer</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/05-layers/06-grid-hex/">Grid (Hex) Layer</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/05-layers/07-filter/">Filter</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/05-layers/08-tables/">Tables</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/05-layers/09-charts/">Charts</a>
      </li>
      
      
      
      <li class="_5 first ">
        <a href="/xyz/docs/00-developer/06-infoj/00-infoj/">InfoJ</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/06-infoj/01-groups/">Groups</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/06-infoj/02-filter/">Filter</a>
      </li>
      
      
      
      <li class="_5  active">
        <a href="/xyz/docs/00-developer/06-infoj/03-lookups/">Lookups</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/06-infoj/04-withSelect/">With Select</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/06-infoj/05-tabledefinition/">Table Definition</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/06-infoj/06-orderedlist/">Ordered List</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/06-infoj/07-geometry/">Geometry</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/06-infoj/08-isolines/">Isolines</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/06-infoj/09-locations/">Locations</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/06-infoj/10-clusterArea/">Cluster Area</a>
      </li>
      
      
      
      <li class="_6 second ">
        <a href="/xyz/docs/00-developer/06-infoj/11-charts/00-charts/">Charts</a>
      </li>
      
      
      
      <li class="_6  ">
        <a href="/xyz/docs/00-developer/06-infoj/11-charts/01-cakeChart/">Cake charts</a>
      </li>
      
      
      
      <li class="_6  ">
        <a href="/xyz/docs/00-developer/06-infoj/11-charts/02-polarChart/">Polar charts</a>
      </li>
      
      
      
      <li class="_6  ">
        <a href="/xyz/docs/00-developer/06-infoj/11-charts/03-radarChart/">Radar charts</a>
      </li>
      
      
      
      <li class="_6  ">
        <a href="/xyz/docs/00-developer/06-infoj/11-charts/04-simpleChart/">Simple charts</a>
      </li>
      
      
      
      <li class="_6  ">
        <a href="/xyz/docs/00-developer/06-infoj/11-charts/05-stackedChart/">Stacked charts</a>
      </li>
      
      
      
      <li class="_5 first ">
        <a href="/xyz/docs/00-developer/07-locales/00-locales/">Locales</a>
      </li>
      
      
      
      <li class="_5  ">
        <a href="/xyz/docs/00-developer/07-locales/01-gazetteer/">Gazetteer</a>
      </li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      

    </ul>

    <div class="content">
      <h2>Lookups</h2>
      <p>Lookups can be used to create aggregate values based on geometry checks.</p>
<p>The <a href="https://www.postgresql.org/docs/current/functions-aggregate.html">PostgreSQL <strong>aggregate</strong> </a> function is used for the aggregation of values which match the spatial lookup condition. The aggregate function will default to SUM. The aggregate function must be part of the function if <code>&quot;fieldfix&quot;:</code> is defined. If not defined the aggregate function must form part of the <code>&quot;lookup&quot;:</code></p>
<p>See examples below.</p>
<pre><code class="language-text">{
  &quot;label&quot;: &quot;OA pop_11&quot;,
  &quot;field&quot;: &quot;pop_11_&quot;,
  &quot;type&quot;: &quot;integer&quot;,
  &quot;lookup&quot;: {
    &quot;table_a&quot;: &quot;dev_polygons&quot;,
    &quot;geom_a&quot;: &quot;a.geom&quot;,
    &quot;table_b&quot;: &quot;schema.dev_points&quot;,
    &quot;geom_b&quot;: &quot;b.geomcntr&quot;,
    &quot;condition&quot;: &quot;ST_INTERSECTS&quot;,
    &quot;aggregate&quot;: &quot;AVG&quot;
  }
}
</code></pre>
<p><em>fig 1. (Look up that makes use of aggregate function)</em></p>
<pre><code class="language-text">{
  &quot;label&quot;: &quot;Population Growth % (2011-17)&quot;,
  &quot;field&quot;: &quot;pop_growth_11_17_5min&quot;,
  &quot;fieldfx&quot;: &quot;SUM(b.pop__17 - b.pop__11) * 100 / SUM(b.pop__11)&quot;,
  &quot;type&quot;: &quot;numeric&quot;,
  &quot;lookup&quot;: {
      &quot;table_a&quot;: &quot;schema.table_a&quot;,
      &quot;table_b&quot;: &quot;schema.table_b&quot;,
      &quot;geom_a&quot;: &quot;isoline_5min&quot;,
      &quot;geom_b&quot;: &quot;geomcntr&quot;
  }
}
</code></pre>
<p><em>fig 2. (Function field that overrides the aggregate)</em></p>
<p><strong>table_a</strong> must be the table which holds the location as defined by an ID in the lookup query.</p>
<p><strong>table_b</strong> must be in the same database but can be in a different schema.</p>
<p>Geometries must be fixed with a. or b. to prevent ambiguous lookups.</p>
<p><strong>geom_a</strong> can be translated to match the epsg of geom_b.</p>
<p><code>&quot;geom_a&quot;: &quot;ST_Transform(ST_Setsrid(a.geom, 4326), 3857)&quot;</code></p>
<p>It is highly recommended that <strong>geom_b</strong> has a spatial index.</p>
<p>The lookup <strong>condition</strong> must be a PostGIS function which takes the locations geometry as first input and the lookup geometry as the second input. The condition will default to <a href="https://postgis.net/docs/ST_Intersects.html">ST_Intersects</a>.</p>

    </div>

  </div>

</body>

<script>
    const toggle = document.getElementById('toggle');

    toggle.onclick = e => { e.target.parentElement.classList.add('_grid'); };
</script>

</html>